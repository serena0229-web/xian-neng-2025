<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™›èƒ½å°¾ç‰™ä¿„ç¾…æ–¯è½‰ç›¤</title>
    <style>
        :root {
            --gold: #ffd700;
            --red: #ff0000;
            --bg: #1a1a1a;
        }
        body { 
            background: var(--bg); color: white; margin: 0; padding: 0;
            font-family: -apple-system, "Microsoft JhengHei", sans-serif;
            display: flex; flex-direction: column; align-items: center; 
            overflow: hidden; height: 100vh;
        }
        .header { margin-top: 20px; text-align: center; }
        h1 { font-size: 1.5rem; color: var(--gold); margin: 0; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        
        /* è½‰ç›¤å®¹å™¨ */
        .wheel-box {
            position: relative; width: 90vw; height: 90vw; max-width: 400px; max-height: 400px;
            margin: 30px 0;
        }
        #canvas { width: 100%; height: 100%; filter: drop-shadow(0 0 15px rgba(0,0,0,0.5)); }
        
        /* æŒ‡é‡ */
        .pointer {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; 
            border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 30px solid var(--red); z-index: 10;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5));
        }

        /* æ§åˆ¶æŒ‰éˆ• */
        .btn-box { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        #spin-btn {
            width: 70%; background: linear-gradient(180deg, #ff4d4d, #b30000);
            color: white; border: none; padding: 15px; font-size: 1.4rem; font-weight: bold;
            border-radius: 50px; box-shadow: 0 5px 15px rgba(255,0,0,0.3);
            cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        #spin-btn:active { transform: scale(0.95); }
        #spin-btn:disabled { background: #555; box-shadow: none; opacity: 0.6; }

        /* ä¸­çç´€éŒ„ */
        .history {
            flex: 1; width: 90%; margin-top: 20px; background: rgba(255,255,255,0.05);
            border-radius: 15px 15px 0 0; padding: 15px; overflow-y: auto;
        }
        .history h3 { font-size: 1rem; color: var(--gold); margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 5px; }
        .win-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ¯ æ™›èƒ½å…¬å¸ 2025 å‘½é‹è½‰ç›¤</h1>
        <div style="font-size: 0.8rem; color: #888;">ä¸€è½‰å®šç”Ÿæ­»ï¼Œå¤§çè·Ÿæˆ‘èµ°</div>
    </div>

    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="canvas" width="800" height="800"></canvas>
    </div>

    <div class="btn-box">
        <button id="spin-btn" onclick="startSpin()">åšå‘½ä¸€è½‰ï¼</button>
        <div id="status" style="color: var(--gold); font-weight: bold; height: 20px;"></div>
    </div>

    <div class="history">
        <h3>ğŸ† æ¦®è€€æ¦œ (ä¸‰è¼ªç´€éŒ„)</h3>
        <div id="history-list"></div>
    </div>

    <script>
        const names = ["é¡§å•", "ä½³ä½³", "å¯Œå“¥", "é™³å§", "æ°‘æ°‘", "å°é›ª", "æ€æ¬£", "é˜¿éƒ", "Amyå§", "ä½©èŒ¹", "ç¾å¿å§", "ç´èŠ¬å§", "å¨¥å¦¹", "å®¶èˆˆå“¥", "é„­å§”å“¡", "å¹¸ç¦ç”·äºº", "æ¦›æ¦›", "èŠ³èŠ³å§", "çµ²æ·‡", "ä¿¡é–"];
        const colors = ["#b30000", "#d4af37", "#800000", "#daa520"];
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const btn = document.getElementById('spin-btn');
        const historyList = document.getElementById('history-list');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        let currentRotation = 0;
        let isSpinning = false;
        let roundCount = 1;

        function drawWheel() {
            const centerX = 400; const centerY = 400; const radius = 380;
            const sliceAngle = (2 * Math.PI) / names.length;

            ctx.clearRect(0, 0, 800, 800);
            names.forEach((name, i) => {
                const angle = i * sliceAngle;
                ctx.fillStyle = colors[i % 4];
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + sliceAngle);
                ctx.fill();
                ctx.strokeStyle = "rgba(255,255,255,0.2)";
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + sliceAngle / 2);
                ctx.fillStyle = "white";
                ctx.font = "bold 28px sans-serif";
                ctx.textAlign = "right";
                ctx.fillText(name, radius - 40, 10);
                ctx.restore();
            });
        }

        function playTick() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
            osc.start(); osc.stop(audioCtx.currentTime + 0.05);
        }

        function startSpin() {
            if (isSpinning || roundCount > 3) return;
            isSpinning = true;
            btn.disabled = true;
            document.getElementById('status').innerText = "é‹è½‰ä¸­...";

            const spinRotations = 10 + Math.random() * 5; 
            const extraDegrees = Math.random() * 360;
            const totalRotation = spinRotations * 360 + extraDegrees;
            
            let start = null;
            const duration = 5000; // 5ç§’è½‰å®Œ
            const initialRotation = currentRotation;

            function animate(timestamp) {
                if (!start) start = timestamp;
                const progress = timestamp - start;
                const t = progress / duration;
                
                // ç·©å‹•å‡½æ•¸ (Ease Out)
                const easeOut = 1 - Math.pow(1 - t, 3);
                const stepRotation = initialRotation + (totalRotation * easeOut);
                
                canvas.style.transform = `rotate(${stepRotation}deg)`;
                
                // æ¨¡æ“¬æ»´ç­”è²ï¼šè§’åº¦è®ŠåŒ–æ™‚æ’­æ”¾
                if (Math.floor(stepRotation / (360/names.length)) !== Math.floor(currentRotation / (360/names.length))) {
                    playTick();
                }
                currentRotation = stepRotation;

                if (progress < duration) {
                    requestAnimationFrame(animate);
                } else {
                    finishSpin();
                }
            }
            requestAnimationFrame(animate);
        }

        function finishSpin() {
            isSpinning = false;
            // è¨ˆç®—ä¸­çè€…ï¼šæŒ‡é‡åœ¨æ­£ä¸Šæ–¹ (270åº¦ä½ç½®)
            const finalAngle = (currentRotation % 360);
            const correctedAngle = (360 - finalAngle + 270) % 360;
            const winnerIndex = Math.floor(correctedAngle / (360 / names.length)) % names.length;
            const winner = names[winnerIndex];

            document.getElementById('status').innerText = `ğŸ‰ æ­å–œï¼š${winner}ï¼`;
            
            // ç´€éŒ„
            const div = document.createElement('div');
            div.className = 'win-item';
            div.innerHTML = `<span>ç¬¬ ${roundCount} è¼ª</span><strong>${winner}</strong>`;
            historyList.prepend(div);

            roundCount++;
            if (roundCount <= 3) {
                btn.disabled = false;
                btn.innerText = `é–‹å§‹ç¬¬ ${roundCount} è¼ª`;
            } else {
                btn.innerText = "ä¸‰è¼ªçµæŸï¼";
            }
        }

        drawWheel();
    </script>
</body>
</html>

